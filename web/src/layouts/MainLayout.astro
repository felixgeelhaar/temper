---
interface Props {
  title: string;
}

const { title } = Astro.props;

const navItems = [
  { href: '/', label: 'Dashboard' },
  { href: '/profile', label: 'Profile' },
  { href: '/sessions', label: 'Sessions' },
  { href: '/analytics', label: 'Analytics' },
];

const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title} â€” Temper</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  </head>
  <body>
    <div class="app">
      <nav class="sidebar">
        <div class="sidebar-brand">
          <h1 class="brand-title">Temper</h1>
          <p class="brand-subtitle">AI Pairing Tool</p>
        </div>
        <ul class="nav-list">
          {
            navItems.map((item) => (
              <li>
                <a
                  href={item.href}
                  class:list={[
                    'nav-link',
                    { active: currentPath === item.href },
                  ]}
                >
                  {item.label}
                </a>
              </li>
            ))
          }
        </ul>
        <div class="sidebar-footer">
          <div class="daemon-status" id="daemon-status">
            <span class="status-dot"></span>
            <span class="status-text">Checking...</span>
          </div>
        </div>
      </nav>
      <main class="content">
        <header class="page-header">
          <h2 class="page-title">{title}</h2>
        </header>
        <div class="page-body">
          <slot />
        </div>
      </main>
    </div>

    <script>
      async function checkDaemon() {
        const el = document.getElementById('daemon-status');
        if (!el) return;
        const dot = el.querySelector('.status-dot') as HTMLElement;
        const text = el.querySelector('.status-text') as HTMLElement;
        try {
          const res = await fetch('/v1/health');
          if (res.ok) {
            dot.style.background = 'var(--color-success)';
            text.textContent = 'Connected';
          } else {
            dot.style.background = 'var(--color-warning)';
            text.textContent = 'Degraded';
          }
        } catch {
          dot.style.background = 'var(--color-danger)';
          text.textContent = 'Offline';
        }
      }
      checkDaemon();
      setInterval(checkDaemon, 30000);
    </script>

    <style is:global>
      :root {
        --color-bg: #0f1117;
        --color-surface: #161822;
        --color-surface-raised: #1e2030;
        --color-border: #2a2d3d;
        --color-text: #cad3f5;
        --color-text-muted: #6e738d;
        --color-primary: #8aadf4;
        --color-primary-dim: #8aadf420;
        --color-success: #a6da95;
        --color-warning: #eed49f;
        --color-danger: #ed8796;
        --color-accent: #c6a0f6;

        --radius: 8px;
        --radius-sm: 4px;
        --sidebar-width: 220px;
        --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
        --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-sans);
        background: var(--color-bg);
        color: var(--color-text);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
      }

      .app {
        display: flex;
        min-height: 100vh;
      }

      .sidebar {
        width: var(--sidebar-width);
        background: var(--color-surface);
        border-right: 1px solid var(--color-border);
        display: flex;
        flex-direction: column;
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        z-index: 10;
      }

      .sidebar-brand {
        padding: 1.5rem 1rem 1rem;
        border-bottom: 1px solid var(--color-border);
      }

      .brand-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--color-primary);
        letter-spacing: -0.02em;
      }

      .brand-subtitle {
        font-size: 0.7rem;
        color: var(--color-text-muted);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-top: 0.15rem;
      }

      .nav-list {
        list-style: none;
        padding: 0.75rem 0.5rem;
        flex: 1;
      }

      .nav-link {
        display: block;
        padding: 0.5rem 0.75rem;
        border-radius: var(--radius-sm);
        color: var(--color-text-muted);
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.15s;
      }

      .nav-link:hover {
        color: var(--color-text);
        background: var(--color-surface-raised);
      }

      .nav-link.active {
        color: var(--color-primary);
        background: var(--color-primary-dim);
      }

      .sidebar-footer {
        padding: 0.75rem 1rem;
        border-top: 1px solid var(--color-border);
      }

      .daemon-status {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.75rem;
        color: var(--color-text-muted);
      }

      .status-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--color-text-muted);
        flex-shrink: 0;
      }

      .content {
        margin-left: var(--sidebar-width);
        flex: 1;
        min-height: 100vh;
      }

      .page-header {
        padding: 1.5rem 2rem 0;
      }

      .page-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--color-text);
      }

      .page-body {
        padding: 1.5rem 2rem 2rem;
      }

      /* Utility classes */
      .card {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: var(--radius);
        padding: 1.25rem;
      }

      .grid {
        display: grid;
        gap: 1rem;
      }

      .grid-2 {
        grid-template-columns: repeat(2, 1fr);
      }

      .grid-3 {
        grid-template-columns: repeat(3, 1fr);
      }

      .grid-4 {
        grid-template-columns: repeat(4, 1fr);
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 700;
        font-family: var(--font-mono);
        color: var(--color-text);
        line-height: 1.2;
      }

      .stat-label {
        font-size: 0.75rem;
        color: var(--color-text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-top: 0.25rem;
      }

      .badge {
        display: inline-block;
        padding: 0.15rem 0.5rem;
        border-radius: 999px;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }

      .badge-success {
        background: #a6da9520;
        color: var(--color-success);
      }

      .badge-warning {
        background: #eed49f20;
        color: var(--color-warning);
      }

      .badge-danger {
        background: #ed879620;
        color: var(--color-danger);
      }

      .badge-info {
        background: #8aadf420;
        color: var(--color-primary);
      }

      @media (max-width: 768px) {
        .sidebar {
          display: none;
        }
        .content {
          margin-left: 0;
        }
        .grid-2,
        .grid-3,
        .grid-4 {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </body>
</html>
